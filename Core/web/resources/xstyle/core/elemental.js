//>>built
define("xstyle/core/elemental",["put-selector/put","xstyle/core/utils","dojo/on","dojo/query"],function(z,A,r){function s(a){/e/.test(g.readyState||"")?a():g.addEventListener("DOMContentLoaded",a)}function t(a){for(var b=g.querySelectorAll(a.selector),e=a.name,k=0,c=b.length;k<c;k++){var f=b[k],l=f.elementalStyle;l||(l=f.elementalStyle={},f.elementalSpecificities={});var d=f.renderings;d||(d=f.renderings=[],m.push(f));d.push({name:e,rendered:l[e]==a.propertyValue,renderer:a});l[e]=a.propertyValue}}
function u(){for(var a=0;a<m.length;a++){var b=m[a],e=b.renderings,k=b.elementalStyle;delete b.renderings;for(var c=0;c<e.length;c++){var f=e[c],d=f.renderer,g=d.rendered;n=k[f.name]==d.propertyValue;if(!g&&n)try{d.render(b)}catch(h){z(b,"div.error",h.toString())}g&&(!n&&d.unrender)&&(d.unrender(b),e.splice(c--,1))}}m=[]}function v(a,b){for(var e=0,k=d.length;e<k;e++){var c=d[e];(!b||b==c.selector)&&w(a,c.rule)&&c.render(a)}}function x(a,b){var e={selector:a.selector,rule:a,render:b};d.push(e);p&&
t(e);u();return{remove:function(){d.splice(d.indexOf(e),1)}}}var g=document,B=1;r(g,g.addEventListener?"change,keydown":"focusout,keydown",function(a){if(!("keydown"==a.type&&13!=a.keyCode)){a=a.target;for(var b=0,e=q.length;b<e;b++){var d=q[b];if(-1<(" "+a.className+" ").indexOf(d.rule.selector.slice(1))){var c=d.definition.valueOf();c&&c.forRule&&(c=c.forRule(d.rule));c&&c.forElement&&(c=c.forElement(a));var f="checkbox"===a.type?a.checked:a.value;"number"===typeof c&&isFinite(f)&&(f=+f);(c=d.definition.put(f))&&
c.forRule&&(c=c.forRule(d.rule));c&&c.forElement&&c.forElement(a)}}}});var h=g.createElement("div"),C={"dom-qsa2.1":!!h.querySelectorAll},y=h.matches||h.matchesSelector||h.webkitMatchesSelector||h.mozMatchesSelector||h.msMatchesSelector||h.oMatchesSelector,d=[],q=[],m=[],p;s(function(){if(!p)if(p=!0,C["dom-qsa2.1"]){for(var a=0,b=d.length;a<b;a++)t(d[a]);u()}else for(var e=g.all,a=0,b=e.length;a<b;a++)v(e[a])});var n,w=y?function(a,b){return y.call(a,b.selector)}:function(a,b){b.ieId||b.setStyle(b.ieId=
"x-ie-"+B++,"true");return!!a.currentStyle[b.ieId]};return{ready:s,on:r,matchesRule:w,addRenderer:x,addInputConnector:function(a,b){q.push({rule:a,definition:b})},update:v,clearRenderers:function(){d=[]},observeForElement:function(a,b,d){return A.when(a,function(a){function c(a){a.observe?a.observe(d):d(a)}a.forElement?x(b,function(b){c(a.forElement(b))}):c(a)})}}});
//# sourceMappingURL=elemental.js.map
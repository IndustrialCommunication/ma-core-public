//>>built
define("xstyle/core/expression",["xstyle/core/utils","xstyle/core/Definition"],function(q,v){function w(f,d){var l=d[0];return l&&f?(l=z(l),w(f.property?f.property(l):f[l],d.slice(1))):f}function x(f,d,l){if(A(d,f)){var b={};b[f]=function(a){for(var b=[],c=0,e=d.length;c<e;c++){var g=d[c];g&&"function"==typeof g[f]&&(g=g[f](a));b[c]=g}return l(b)};return b}return l(d)}function s(f,d){return{apply:function(c,b,a){for(var h=0,n=b.length;h<n;h++){var e=b[h];e.depend&&e.depend(a)}h=function(){var g=[];
if(f.selfExecuting)return f.apply(c,b,a);for(var d=0,e=b.length;d<e;d++)g[d]=b[d].valueOf();if(f.selfWaiting)return f.apply(c,g,a);g.push(c);return q.whenAll(g,function(b){var d=b.pop();return x("forRule",b,function(b){return x("forElement",b,function(b){return f.apply(d,b,a)})})})};h.reverse=function(a){return d(a,b)};return h}}}function u(f){return y[f]||(y[f]=new Function("a","b","return "+f))}function c(f,d,c,b,a){function h(b){b.skipResolve=!0;b.precedence=d;b.infix=!1!==a}var p=function(f,d){var c=
d[0],e=d[1];if(c&&c.put)e=b(f,e&&e.valueOf()),e!==B&&c.put(e);else if(e&&e.put)e.put(a(f,c&&c.valueOf()));else throw new TypeError("Can not put");},e={apply:function(d,e,k){var t;c=u(c);b=b&&u(b);a=a&&u(a);n[f]=t=s(c,p);h(t);return t.apply(d,e,k)}};h(e);n[f]=e}function r(c,d){function l(a){for(;p<=a.precedence;){var b=e.pop(),c=n[e.pop()],d=new v;d.setCompute(c.apply(null,c.infix?[e.pop(),b]:[b],d));g=e.length?e[e.length-1]:void 0;e.push(d);p=g&&n[g]&&n[g].precedence}}var b,a;d=d.join?d.slice():[d];
for(b=0;b<d.length;b++)if(a=d[b],"string"==typeof a){var h=a.match(/"[^\"]*"|[+\-<>\|\/\?\:^*!&|]+|[\w_$\.\/-]+/g);a=[b,1];h&&a.push.apply(a,h);d.splice.apply(d,a);b+=a.length-3}var p,e=[],g,h={};for(b=0;b<d.length;b++){a=d[b];if("("==a.operator){var m=e[e.length-1];void 0===m||n.hasOwnProperty(m)?a=r(c,a.getArgs()[0]):(e.pop(),a=function(a,b){var d,e,g=new v(function(){return q.when(a.valueOf(),function(h){var l=a.parent&&a.parent.valueOf();if(!h.selfResolving){if(!d){d=[];for(var k=0,m=b.length;k<
m;k++)d[k]=r(c,b[k]);e=s(h).apply(l,d,g)}return e()}return h.apply(l,b,g).valueOf()})});return g}(m,a.getArgs()))}else if(n.hasOwnProperty(a))m=n[a],l(m),p=(g||m).precedence;else if(-1<a)a=+a;else if(a.isLiteralString)a=a.value;else{a=a.split(/\s*\/\s*/);var m=a[0],k=c.getDefinition(m);if("string"==typeof k||k instanceof Array)k=r(c,k);else if(void 0===k)throw Error('Could not find reference "'+m+'"');h[m]=k;1<a.length&&(k=w(k,a.slice(1)));a=k}e.push(a)}l({precedence:100});if(1<e.length)throw Error("Could not reduce expression");
a=e[0];a.inputs=h;return a}var z=q.convertCssNameToJs,A=q.someHasProperty,B={},y={},n={};c("+",6,"a+b","a-b","a-b");c("-",6,"a-b","a+b","b-a");c("*",5,"a*b","a/b","a/b");c("/",5,"a/b","a*b","b/a");c("?",16,"b[a?0:1]","a\x3d\x3d\x3db[0]||(a\x3d\x3d\x3db[1]?false:deny)","[a,b]");c(":",15,"[a,b]","a[0]?a[1]:deny","a[1]");c("!",4,"!a","!a",!1);c("%",5,"a%b");c("\x3e",8,"a\x3eb");c("\x3e\x3d",8,"a\x3e\x3db");c("\x3c",8,"a\x3cb");c("\x3c\x3d",8,"a\x3c\x3db");c("\x3d\x3d",9,"a\x3d\x3d\x3db");c("\x26",8,
"a\x26\x26b");c("|",8,"a||b");return{react:s,evaluate:r,selfResolving:function(c){c.selfResolving=!0;return c}}});
//# sourceMappingURL=expression.js.map